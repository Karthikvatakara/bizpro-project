<%- include('../admin/layouts/header')%>
<%- include('../admin/partials/adminheader')%>


<div class="container-fluid"  >
    <div class="row  border-start">
        <main class="px-md-4 icons">
            <div class="row d-flex justify-content-between">
                <div class="col-md-8">
                    <h1 class="mt-5">EDIT PRODUCT</h1>
                    <br>
                    <form action="/admin/editproduct/<%=product._id%>" method="post" enctype="multipart/form-data" class="bg-white">
                        <div class="form-group">
                            <label for="productName">Product Name:</label>
                            <input
                                type="text"
                                value="<%=product.ProductName%>"
                                name="ProductName"
                                class="form-control bg-light"
                                id="productName"
                                placeholder="Enter product name"
                                required
                            />
                        </div><br>

                        <div class="form-group">
                            <label for="productDescription">Product Description:</label>
                            <input
                                type="text"
                                value="<%=product.Description%>"
                                class="form-control bg-light"
                                name="Description"
                                id="productDescription"
                                rows="4"
                                placeholder="Enter product description"
                                required
                            >
                        </div>
                        <br >
                        <div class="form-group">
                            <label for="productSpecification">Product Specification:</label>
                            <input
                                type="text"
                                value="<%=product.specification1 %>"
                                class="form-control bg-light"
                                name="Specification1"
                                id="productSpecification1"
                                placeholder="Enter product Specification"
                                required
                            ><br>
                            <label for="productspecification2">Product Specification:</label>
                            <input
                                type="text"
                                value="<%=product.specification2%>"
                                class="form-control bg-light"
                                name="Specification2"
                                id="productSpecification2"
                                placeholder="Enter product Specification"
                                required
                            ><br>
                            <label for="productspecification3">Product Specification:</label>
                            <input
                                type="text"
                                value="<%=product.specification3%>"
                                class="form-control bg-light"
                                name="Specification3"
                                id="productSpecification3"
                                placeholder="Enter product Specification"
                                required
                            ><br>
                        </div>
                        <br>

                        <div class="border p-3 mb-3 bg-light "> <!-- Added bg-light and text-center classes -->
                            <h3>Media</h3>
                            <div class="form-group text-center">
                                <label for="image1">Image 1:</label>
                                <input
                                  type="file"
                                  name="image1"
                   
                                  class="form-control-file"
                                  id="image1"
                                  accept="image/*"
                                />
                                <img src="/uploads/<%= product.imageUrl[0] %>" alt="Image 1" class="img-fluid" id="uploadedImage1" style="max-height: 200px;">
                              </div>
                              <div class="form-group text-center">
                                <label for="image2">Image 2:</label>
                                <input
                                  type="file"
                                  name="image2"
                                  value="<%= product.imageUrl[1] %>"
                                  class="form-control-file"
                                  id="image2"
                                  accept="image/*"
                                />
                                <img src="/uploads/<%= product.imageUrl[1] %>" alt="Image 2" class="img-fluid" id="uploadedImage2" style="max-height: 200px;">
                              </div>
                              <div class="form-group text-center">
                                <label for="image3">Image 3:</label>
                                <input
                                  type="file"
                                  name="image3"
                                  value="<%= product.imageUrl[2] %>"
                                  class="form-control-file"
                                  id="image3"
                                  accept="image/*"
                                />
                                <img src="/uploads/<%= product.imageUrl[2] %>" alt="Image 3" class="img-fluid" id="uploadedImage3" style="max-height: 200px;">
                              </div>
                            </div>


                        <div class="border p-3 mb-3">
                            <h2>Pricing</h2>
                            <div class="form-group">
                                <label for="basePrice">Base Price:</label>
                                <input
                                    value="<%=product.Price%>"
                                    type="number"
                                    name="Price"
                                    class="form-control bg-light"
                                    id="basePrice"
                                    placeholder="Enter base price"
                                    required
                                />
                            </div>
                            <br>
                            <div class="form-group">
                                <label for="discountAmount">Discount Amount:</label>
                                <input
                                    value="<%=product.DiscountAmount%>"
                                    type="number"
                                    name="DiscountAmount"
                                    class="form-control bg-light"
                                    id="discountAmount"
                                    placeholder="Enter discount amount"
                                    required
                                />
                            </div>
                        </div>


                        <div class="border p-3 mb-3">
                            <h2>Stock</h2>
                            
                            <div class="form-group">
                                <label for="quantity">Quantity:</label>
                                <input
                                    type="number"
                                    value="<%=product.AvailableQuantity%>"
                                    name="AvailableQuantity"
                                    class="form-control bg-light"
                                    id="quantity"
                                    placeholder="Enter quantity"
                                    required
                                />
                            </div>
                        </div>
                </div>


                <div class="col-md-4 my-5">
                    <div class="bg-white p-3">
                        <div class="form-group">
                            <label for="category">Category:</label>
                            <select class="form-select bg-light" id="category" name="Category" required>
                                <% category.forEach(function(cat) { %>
                                    <option value="<%= cat.name %>" <%= product.category.equals(cat._id) ? 'selected' : '' %>><%= cat.name %></option>
                                <% }); %>
                            </select>
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="brandName">Brand Name:</label>
                            <select name="BrandName" class="form-select bg-light" id="brand" required>
                                <% brands.forEach(function(brand) { %>
                                    <option value="<%= brand.name %>" <%= product.BrandName.equals(brand._id) ? 'selected' : '' %>><%= brand.name %></option>
                                <% }); %>
                            </select>
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="tags">Tags:</label>
                            <input
                                type="text"
                                value="<%= product.tags %>"
                                class="form-control bg-light"
                                name="tags"
                                id="tags"
                                placeholder="Enter tags"
                                required
                            />
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary ms-3">Edit Product</button>
                </div>
                


                </form>
            </div>
        </main>
    </div>
</div>

</body>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="/js/script.js"></script>
<script>
    // Function to update the preview image when a file is selected
    function updatePreviewImage(inputId, imageId) {
        const fileInput = document.getElementById(inputId);
        const previewImage = document.getElementById(imageId);

        fileInput.addEventListener('change', function() {
            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();

                reader.onload = function(e) {
                    previewImage.src = e.target.result;
                };

                reader.readAsDataURL(file);
            } else {
                previewImage.src = ''; // Clear the image when no file is selected
            }
        });
    }

    // Call the function for each file input
    updatePreviewImage('image1', 'uploadedImage1');
    updatePreviewImage('image2', 'uploadedImage2');
    updatePreviewImage('image3', 'uploadedImage3');

  


  document.addEventListener('DOMContentLoaded', function () {
    var form = document.querySelector('form');

    form.addEventListener('submit', function (event) {
      event.preventDefault();
      if (validateForm()) {
        form.submit();
      }
    });

    function validateForm() {
      var productName = document.getElementById('productName').value.trim();
      var productDescription = document.getElementById('productDescription').value.trim();
      var specification1 = document.getElementById('productSpecification1').value.trim();
      var specification2 = document.getElementById('productSpecification2').value.trim();
      var specification3 = document.getElementById('productSpecification3').value.trim();
      var tags = document.getElementById('tags').value.trim();
      var basePrice = parseFloat(document.getElementById('basePrice').value);
      var discountAmount = parseFloat(document.getElementById('discountAmount').value);
      var quantity = parseInt(document.getElementById('quantity').value);

      if (!productName || !productDescription || !specification1 || !specification2 || !specification3 || !tags) {
        alert('Product name, description, specifications, and tags are required.');
        return false;
      }

      if (!productName.replace(/\s/g, '').length || !productDescription.replace(/\s/g, '').length || !specification1.replace(/\s/g, '').length || !specification2.replace(/\s/g, '').length || !specification3.replace(/\s/g, '').length || !tags.replace(/\s/g, '').length) {
        alert('Product name, description, specifications, and tags cannot contain only white spaces.');
        return false;
      }

      if (isNaN(basePrice) || basePrice <= 0) {
        alert('Base price must be a positive number.');
        return false;
      }

      if (isNaN(discountAmount) || discountAmount < 0 || discountAmount >= basePrice * 0.1) {
        alert('Discount amount must be a non-negative value and less than 10% of the base price.');
        return false;
      }

      if (isNaN(quantity) || quantity < 0) {
        alert('Quantity must be a non-negative integer.');
        return false;
      }

      return true;
    }
  });

</script>
</html>