<%- include('../user/layouts/header')%>
<%- include('../user/partials/userheader')%>  

    
    <div class="modal fade" id="addAddressModal" tabindex="-1" aria-labelledby="addAddressModalLabel" aria-hidden="true">
      <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="addAddressModalLabel">Add Address</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="/addAddress" method="post" onsubmit="return validateForm()">
                    <div class="mb-3">
                        <label for="fullName" class="form-label">Full Name</label>
                        <input type="text" class="form-control" name="Name"  id="fullName" placeholder="Enter your full name" required>
                      </div>
                      <div class="mb-3">
                        <label for="address" class="form-label">Address</label>
                        <input type="text" class="form-control" name="AddressLane" id="address" placeholder="Enter your address" required>
                      </div>
                      <div class="mb-3">
                        <label for="city" class="form-label">City</label>
                        <input type="text" class="form-control" id="city" name="City" placeholder="Enter your city" required>
                      </div>
                      <div class="mb-3">
                        <label for="pincode" class="form-label">Pincode</label>
                        <input type="text" class="form-control" id="pincode" name="Pincode" placeholder="Enter your pincode" required>
                      </div>
                      <div class="mb-3">
                        <label for="state" class="form-label">State</label>
                        <input type="text" class="form-control" id="state" name="State" placeholder="Enter your state" required>
                      </div>
                      <div class="mb-3">
                        <label for="mobileNumber" class="form-label">Mobile Number</label>
                        <input type="tel" class="form-control" id="mobileNumber" name="Mobile" placeholder="Enter your mobile number" required>
                      </div>
                      <div class="error-message"
                      style="display: none; font-weight: bold; color: #ff0019; padding: 10px; "
                      id="errorMessage"></div>
                    <button type="submit" class="btn btn-primary"  >Submit</button>
                  </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      

      <!-- edit address -->
     <!-- edit address -->
    <% user.Address.forEach(function(Address) { %>
        <div class="modal fade" id="editAddressModal<%=Address._id%>" tabindex="-1" aria-labelledby="editAddressModalLabel<%=Address._id%>" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content ">
              <div class="modal-header">
                <h5 class="modal-title" id="editAddressModalLabel<%=Address._id%>">Edit Address</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <form action="/editAddress/<%=Address._id %>" method="post" >
                  <div class="mb-3">
                    <label for="fullName" class="form-label">Full Name</label>
                    <input type="text" class="form-control" name="Name" value="<%=Address.Name%>"  id="fullName<%=Address._id%>" placeholder="Enter your full name" required>
                  </div>
                  <div class="mb-3">
                    <label for="address" class="form-label">Address</label>
                    <input type="text" class="form-control" name="AddressLane" value="<%=Address.AddressLane%>" id="address<%=Address._id%>" placeholder="Enter your address" required>
                  </div>
                  <div class="mb-3">
                    <label for="city" class="form-label">City</label>
                    <input type="text" class="form-control" id="city<%=Address._id%>" name="City" value="<%=Address.City%>"  placeholder="Enter your city" required>
                  </div>
                  <div class="mb-3">
                    <label for="pincode" class="form-label">Pincode</label>
                    <input type="text" class="form-control" id="pincode<%=Address._id%>" name="Pincode" value="<%=Address.Pincode%>" placeholder="Enter your pincode" required>
                  </div>
                  <div class="mb-3">
                    <label for="state" class="form-label">State</label>
                    <input type="text" class="form-control" id="state<%=Address._id%>" name="State" value="<%=Address.State%>" placeholder="Enter your state" required>
                  </div>
                  <div class="mb-3">
                    <label for="mobileNumber" class="form-label">Mobile Number</label>
                    <input type="tel" class="form-control" id="mobileNumber<%=Address._id%>" name="Mobile" value="<%= Address.Mobile%>" placeholder="Enter your mobile number" required>
                  </div>
                  <div class="error-message"
                      style="display: none; font-weight: bold; color: #ff0019; padding: 10px; "
                      id="errorMessage"></div>
                  <button type="submit" class="btn btn-primary">Submit</button>
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>
      <%})%>
      
    
    <div class="container" style="padding-top: 100px;">
        <% if(message.updated ){ %>
            <div class="alert alert-success" role="alert">
                <%= message.updated %>
              </div>
              <% } %>
              <% if(message.notFound ){ %>
                <div class="alert alert-warning" role="alert">
                    <%= message.notFound %>
                  </div>
                  <% } %>
                  <% if(message.deleted ){ %>
                    <div class="alert alert-success" role="alert">
                        <%= message.deleted %>
                      </div>
                      <% } %>
                      <% if(message.added ){ %>
                        <div class="alert alert-success" role="alert">
                            <%= message.added %>
                          </div>
                          <% } %>
        <h3 class="text-start ">User Addresses</h3>
        <%if(user.Address.length > 0){%>
          <% user.Address.forEach(function(Address) { %>
        <div class="row">  
            <div class="col-md-6">
                <div class="card mb-4 bg-white">
                    <div class="card-body">
                        <h5 class="card-title" style="color: black;"><%=Address.Name%></h5>
                        <p class="card-text"><%=Address.AddressLane%></p>
                        <p class="card-text"><%=Address.City%></p>
                        <p class="card-text"><%=Address.Pincode%></p>
                        <p class="card-text"><%=Address.State%></p>
                        <p class="card-text"><%=Address.Mobile%></p>
                        <button  class="btn btn-info" data-bs-toggle="modal" data-bs-target="#editAddressModal<%=Address._id%>">
                            <i class="fas fa-plus-circle"></i> Edit Address
                           </button>
                           <a href="/deleteAddress/<%= Address._id %>" class=" ml-5 btn btn-sm btn-secondary">Delete</a>
                    </div>
                </div>
            </div>
        </div>
        <%})%>
        <%}else{%>
          <div class="row">
              <div class="col-md-12">
                  <div class="card text-bg-white">
                      <div class="card-body icons text-center" >
                          <h7 style="font-family: Verdana, Geneva, Tahoma, sans-serif;" >NO ADDRESS SAVED TILL YET</h1>
                      </div>
                  </div>
              </div>
          </div>
    
          <%}%>
    
    
        <button  class="btn btn-info" data-bs-toggle="modal" data-bs-target="#addAddressModal">
            <i class="fas fa-plus-circle"></i> Add Address
           </button>
    </div

        
    <%- include('../user/partials/userfooter')%>
    <script>
     const  validateForm = (modalId) => {
    // Get form inputs within the specific modal
    var fullName = document.getElementById('fullName' + modalId).value;
    var address = document.getElementById('address' + modalId).value;
    var city = document.getElementById('city' + modalId).value;
    var pincode = document.getElementById('pincode' + modalId).value;
    var state = document.getElementById('state' + modalId).value;
    var mobileNumber = document.getElementById('mobileNumber' + modalId).value;

    // Validate each field
    if (fullName === '' || address === '' || city === '' || pincode === '' || state === '' || mobileNumber === '') {
        const errorMessage = document.getElementById('errorMessage' + modalId);
        errorMessage.innerHTML = 'Please fill in all fields!';
        errorMessage.style.display = 'block';
        return false;
    }

    // Additional validation for fullName, address, city, and state
    var nameRegex = /^[a-zA-Z]+$/;
    if (!fullName.match(nameRegex) || !address.match(nameRegex) || !city.match(nameRegex) || !state.match(nameRegex)) {
        const errorMessage = document.getElementById('errorMessage' + modalId);
        errorMessage.innerHTML = 'Invalid characters in name, address, city, or state fields!';
        errorMessage.style.display = 'block';
        return false;
    }

    // Validate pincode
    var pincodeRegex = /^[1-9]\d{5}$/;
    if (!pincode.match(pincodeRegex)) {
        const errorMessage = document.getElementById('errorMessage' + modalId);
        errorMessage.innerHTML = 'Pincode is not valid!';
        errorMessage.style.display = 'block';
        return false;
    }

    // Validate mobile number
    var mobileRegex = /^[1-9]\d{9}$/;
    if (!mobileNumber.match(mobileRegex)) {
        const errorMessage = document.getElementById('errorMessage' + modalId);
        errorMessage.innerHTML = 'Mobile number is not valid!';
        errorMessage.style.display = 'block';
        return false;
    }

    return true;
}

    </script>
    <%- include('../user/layouts/footer') %>
    



